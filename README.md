# Парсер

## Анализ задачи
- Проанализированы продукты экосистемы МТС и их конкурентов. В качестве конкурента MTC Travel выбран сервис Ostrovok.ru.
- Бизнес-цель: Получение списка всех отелей, доступных в сервисе Ostrovok.ru, вместе с их ключевыми характеристиками для анализа рынка и конкуренции.
- Анализ сайта Ostrovok.ru выявил endpoint для получения информации об отелях в заданном городе. Обнаружено значение Cookie `otaOverlayDatelessSerp=1`, позволяющее получать данные вне зависимости от дат заезда.
- Endpoint имеет формат: `https://ostrovok.ru/hotel/{country}/{city}/`.
- Для определения корректных значений `{country}` и `{city}` используется найденный в процессе анализа страницы endpoint для поиска городов и стран: это позволяет получать данные для любого интересующего города.


## Цель
Реализация REST API на базе Quarkus, предоставляющего:

1.  Endpoint для парсинга данных об отелях из Ostrovok.ru по названию города.
2.  Endpoint для получения списка отелей с возможностью фильтрации по различным параметрам.


## Стек
- Quarkus (Выбран из-за cоответствия технологическому стеку команды разработки)
- JSoup (Выбран из-за быстрого времени работы и качественного и удобного API)
- PostgreSQL (Выбран в качестве базы данных из-за поддержки операции `INSERT ON CONFLICT DO`)
- Liquibase 

## Схема БД
![alt text](https://i.imgur.com/l2wlZPY.jpeg)

## Описание Endpoint-ов
#### 1. Парсинг отелей по городу
Структура:
- Endpoint: /api/v1/parse/hotels
-  Метод: POST
-  Описание: Запускает процесс парсинга данных об отелях для указанного города. Полученные данные сохраняются или обновляются в базе данных.

Параметры:
- city (String, обязательный): Название города для поиска (например, "Омск"). Поддерживается частичное совпадение названий городов.

Пример запроса:
```
POST /api/v1/parse/hotels?city=Омск
```
- Стандартный ответ: 204 No Content


#### 2. Получение списка отелей с фильтрацией
Структура:
-  Endpoint: /api/v1/hotels
-  Метод: GET
-  Описание: Возвращает список отелей, соответствующих заданным критериям фильтрации.

  Параметры (все необязательные):

  -  count-stars-from (Integer): Минимальное количество звезд (включительно).
  -  count-stars-to (Integer): Максимальное количество звезд (включительно).
  -  rating-from (Decimal): Минимальный рейтинг (включительно).
  -  rating-to (Decimal): Максимальный рейтинг (включительно).
  -  min-price-from (Integer): Минимальная цена номера (включительно).
  -  min-price-to (Integer): Максимальная цена номера (включительно).
  -  country (String): Название страны.
  -  city (String): Название города.

  Пример запроса:

```
GET /api/v1/hotels?count-stars-from=3&count-stars-to=4&rating-from=7.5&country=Россия&city=Москва
```

Пример ответа (200 OK):
```
json
[
    {
        "id": 8051,
        "ostrovokId": 7750092,
        "name": "Cronwell Park Ника",
        "address": "ул. Суворова, д. 110, Омск",
        "countOfStars": 3,
        "minPricePerNight": 3683,
        "rating": 7.2,
        "href": "/hotel/russia/omsk/mid7750092/nika_hotel_complex/",
        "cityId": 7
    }
]
```

## Итоги
-  Реализованы оба REST API endpoint-а, описанные в разделе Цель.
-  Схема базы данных полностью определена и зафиксирована в Liquibase changelog-ах.
-  Реализована обработка ошибок для всех основных сценариев. В случае ошибок возвращаются информативные сообщения.
-  Написаны Unit-тесты, которые покрывают основные сценарии работы сервиса.
-  Скомпилирован и успешно протестирован native-ный образ для GraalVM.
-  Теперь аналитики могут ответь на такие вопросы: 
   - Какое количество отелей в некотором городе на сайте Ostrovok?
   - Какое у них среднее значение рейтинга?
   - Какое среднее значение минимальной цены за ночь?
   - Какая минимальная цена 5 звездочного отеля в некоторой стране?
   - и т. д.
